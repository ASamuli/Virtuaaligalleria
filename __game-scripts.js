var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:100,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.05,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3,this.app.mouse.on("mousemove",this._onMouseMove,this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0===r&&0===n||(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[1])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var PointAndClick=pc.createScript("pointAndClick");PointAndClick.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),PointAndClick.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PointAndClick.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),PointAndClick.prototype.initialize=function(){this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(4e3,.001,4e3)),this.direction=new pc.Vec3,this.distanceToTravel=1,this.targetPosition=new pc.Vec3,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this)}),this)},PointAndClick.newPosition=new pc.Vec3,PointAndClick.prototype.update=function(t){if(this.direction.lengthSq()>0){var i=this.playerSpeed*t,n=PointAndClick.newPosition;n.copy(this.direction).scale(i),n.add(this.playerEntity.getPosition()),this.playerEntity.setPosition(n),this.distanceToTravel-=i,this.distanceToTravel<=0&&(this.playerEntity.setPosition(this.targetPosition),this.direction.set(0,0,0))}},PointAndClick.prototype.movePlayerTo=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.playerEntity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.playerEntity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.playerEntity.lookAt(this.targetPosition)):this.direction.set(0,0,0)},PointAndClick.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},PointAndClick.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())},PointAndClick.ray=new pc.Ray,PointAndClick.hitPosition=new pc.Vec3,PointAndClick.prototype.doRayCast=function(t){var i=PointAndClick.ray,n=PointAndClick.hitPosition;this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.nearClip,i.origin),this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,i.direction),i.direction.sub(i.origin).normalize(),this.groundShape.intersectsRay(i,n)&&this.movePlayerTo(n)};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var t=this.entity.getRotation();if(this._yaw=this._calcYaw(t),this._pitch=this._clampPitchAngle(this._calcPitch(t,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,n=0;if(t instanceof pc.Entity){var s=[],r=t.findComponents("render");for(a=0;a<r.length;++a)for(e=r[a].meshInstances,n=0;n<e.length;n++)s.push(e[n]);var h=t.findComponents("model");for(a=0;a<h.length;++a)for(e=h[a].meshInstances,n=0;n<e.length;n++)s.push(e[n]);for(a=0;a<s.length;a++)0===i?this._modelsAabb.copy(s[a].aabb):this._modelsAabb.add(s[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var n=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,n),Math.atan2(n.y,-n.z)*pc.math.RAD_TO_DEG};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("cameraEntity",{type:"entity"}),PlayerController.attributes.add("animEntity",{type:"entity"}),PlayerController.attributes.add("power",{type:"number",default:45e4}),PlayerController.attributes.add("joystickId",{type:"string"}),PlayerController.attributes.add("attackButtonId",{type:"string"}),PlayerController.attributes.add("specialButtonId",{type:"string"}),PlayerController.prototype.initialize=function(){this._anim=this.animEntity.anim,this._angle=0,this._frameMovementRight=new pc.Vec3,this._frameMovementForward=new pc.Vec3,this._frameMovementTotal=new pc.Vec3},PlayerController.prototype.update=function(t){const e=window.touchJoypad,a=e.sticks[this.joystickId];if(this._frameMovementRight.copy(this.cameraEntity.right),this._frameMovementForward.copy(this.cameraEntity.forward),this._frameMovementTotal.copy(pc.Vec3.ZERO),this._frameMovementRight.y=0,this._frameMovementRight.normalize(),this._frameMovementRight.scale(a.x),this._frameMovementForward.y=0,this._frameMovementForward.normalize(),this._frameMovementForward.scale(a.y),this._frameMovementTotal.add2(this._frameMovementRight,this._frameMovementForward),!this._anim.baseLayer.activeState.startsWith("Attack")){if(0!==this._frameMovementTotal.x||0!==this._frameMovementTotal.z){this._frameMovementTotal.scale(this.power),this.entity.rigidbody.applyForce(this._frameMovementTotal),this._anim.setFloat("speed",this.entity.rigidbody.linearVelocity.length());const t=90-Math.atan2(this._frameMovementTotal.z,this._frameMovementTotal.x)*pc.math.RAD_TO_DEG;this._angle=pc.math.lerpAngle(this._angle,t,.4)%360,this.animEntity.setEulerAngles(0,this._angle,0)}else this._anim.setFloat("speed",0);e.buttons.wasPressed(this.attackButtonId)?this._anim.baseLayer.transition("Attack Basic"):e.buttons.wasPressed(this.specialButtonId)&&this._anim.baseLayer.transition("Attack Special")}};var OrbitCameraTouchJoypadInput=pc.createScript("orbitCameraTouchJoypadInput");OrbitCameraTouchJoypadInput.attributes.add("joystickId",{type:"string"}),OrbitCameraTouchJoypadInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),OrbitCameraTouchJoypadInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},OrbitCameraTouchJoypadInput.prototype.update=function(t){const i=window.touchJoypad.sticks[this.joystickId];this.orbitCamera.pitch+=i.y*this.orbitSensitivity*t,this.orbitCamera.yaw-=i.x*this.orbitSensitivity*t};var OrbitCameraFollowEntity=pc.createScript("orbitCameraFollowEntity");OrbitCameraFollowEntity.attributes.add("followEntity",{type:"entity"}),OrbitCameraFollowEntity.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},OrbitCameraFollowEntity.prototype.postUpdate=function(t){this.orbitCamera.pivotPoint=this.followEntity.getPosition()};var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,o=this.app.graphicsDevice.canvas.clientWidth,e=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/o,i.y=t.y/e,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),o=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const e=TouchJoystick.__tempNubPos;e.copy(this.nubEntity.getLocalPosition());if(e.lengthSq()>=o){if("drag"===this.type){const t=e.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(e),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}e.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(e)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),o=Math.sign(i.x),e=Math.sign(i.y),s=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*o,n=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*e;this._setAxisValues(s/t,n/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var e=this.app;e.mouse.on("mousemove",this.onMouseMove,this),e.mouse.on("mousedown",this.onMouseDown,this),this.rayEnd=e.root.findByName("RaycastEndPoint"),this.on("destroy",(function(){e.mouse.off("mousemove",this.onMouseMove,this),e.mouse.off("mousedown",this.onMouseDown,this)}),this)},CameraMovement.prototype.postUpdate=function(e){var t=this.entity.parent,o=this.eulers.x+180,s=this.eulers.y,i=new pc.Vec3(-s,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.mouseSpeed*e.dx/60%360,this.eulers.y+=this.mouseSpeed*e.dy/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360))},CameraMovement.prototype.onMouseDown=function(e){this.app.mouse.enablePointerLock()},CameraMovement.prototype.getWorldPoint=function(){var e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t};